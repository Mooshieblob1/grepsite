---
// Import layout and components
import BaseLayout from "../layouts/BaseLayout.astro";
import StatsCards from "../components/StatsCards.astro";
import CarrierOverview from "../components/CarrierOverview.astro";
import CostAnalysis from "../components/CostAnalysis.astro";
import RecentActivity from "../components/RecentActivity.astro";
import { DataService } from "../lib/data";

// Load real data for MVP1 dashboard
const lines = await DataService.getLines();
const tickets = await DataService.getTickets();
const carrierStats = DataService.calculateCarrierStats(lines);

// Any server-side logic can go here
const title = "BlobLogic - Dashboard";
---

<BaseLayout title={title} pageTitle="Dashboard" currentPage="dashboard">
  <!-- Stats Cards with real data -->
  <StatsCards lines={lines} tickets={tickets} />

  <!-- Carrier Management Section -->
  <CarrierOverview />

  <!-- Cost Analysis Section -->
  <CostAnalysis />

  <!-- Recent Activity -->
  <RecentActivity />
</BaseLayout>

<!-- Pass real data to charts -->
<script define:vars={{ lines, carrierStats }}>
  // Make data available to chart scripts
  window.dashboardData = {
    lines: lines,
    carrierStats: carrierStats
  };
</script>
